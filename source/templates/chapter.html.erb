---
layout: layout
---

<%= partial "layouts/partials/header" %>

<article class="chapter theme-<%= locals[:color] %>">
    <header class="chapter-hero">
        <h1 class="hero-headline"><%= locals[:title].titleize %></h1>
    </header>

    <!-- Introduction -->
    <div class="chapter-section first l-wrapper narrow" id="intro">
        <%# https://forum.middlemanapp.com/t/sitemap-where-querying-the-sitemap/1241/2 %>
        <% sitemap.where(:chapter => locals[:slug], :type => "introduction").order_by(:order).all.each do |intro| %>
            <%# http://stackoverflow.com/questions/25219509/how-to-get-the-raw-content-from-all-pages %>
            <%= intro.render %>
        <% end %>
    </div>

    <!-- Sections -->
    <% sitemap.where(:chapter => locals[:slug]).order_by(:order).all.each do |section| %>
        <% unless section.data.type == "introduction" %>
            <section class="chapter-section<% if section.data.type.present? %> <%= section.data.type %><% end %>" id="composition">
                <h2 class="chapter-subtitle"><%= section.data.title %></h2>
                <div class="l-wrapper narrow">
                    <%= section.render %>
                </div>
            </section>
        <% end %>
    <% end %>
</article>

<!-- Local navigation (next/prev chapters) -->
<nav class="pagination">
    <h2 class="pagination-slug">Read more</h2>
    <ul class="l-wrapper">
        <% unless first_page(locals[:slug]) %>
        <li class="pagination-prev">
            <a href="<%= pagination_url(locals[:slug], "prev") %>">
                <span class="pagination-subtitle">Previous</span>
                <strong class="pagination-title"><%= pagination_title(locals[:title], "prev") %></strong>
            </a>
        </li>
        <% end %>
        <% unless last_page(locals[:slug]) %>
        <li class="pagination-next">
            <a href="<%= pagination_url(locals[:slug], "next") %>">
                <span class="pagination-subtitle">Next</span>
                <strong class="pagination-title"><%= pagination_title(locals[:title], "next") %></strong>
            </a>
        </li>
        <% end %>
    </ul>
</nav>
