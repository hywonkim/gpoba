/* ==========================================================================
//  Main navigation modules
// -> the horizontal "table of contents"
// ========================================================================== */

@import "../core/*";
@import "../atoms/text";

$nav-break: 'medium';
$nav-label-break: 780px;

/* Base
// -------------------------------------------------------------------------- */

.nav {
    @include unstyled-list;
    z-index: $z--nav;

    @include respond-to($nav-break) { padding: 0; }

    ul {
        margin: 0;
        padding: 0;
    }

    li {
        display: block;
        list-style: none;
        margin: 0;
        padding: 0;
    }
}

/* Modifiers
// -------------------------------------------------------------------------- */

/* ------- STATE: above/below ----------------------------------------------- */
// -> the nav's relationship to the section 'border'.
// -> used to place the highlight rule over or under the active item.
.nav.is-above {}


/* Submodules
// -------------------------------------------------------------------------- */

// "small" (next/prev page) nav used on small screens
.nav-pagination {
    display: block;
    font-size: 0;
    list-style: none;

    @include respond-to($nav-break) { display: none; }

    > ul {
        display: inline-block;
        float: right;
    }

    li {
        @include border(right, $color: theme(border, reverse));
        display: inline-block;
        font-size: 16px;

        &:first-child { @include border(left, $color: theme(border, reverse)); }
        &:last-child { border: none; }
    }
}

// full nav used on large screens
// => becomes a flyout on small screens
.nav-toc {
    // flyout state @ small screens
    $pointer-size: 14px;

    @extend %base-transition;
    @include unstyled-list;
    @include border;
    display: none;
    position: absolute;
    min-width: em(180px);
    list-style: none;
    background-color: theme(bg);
    border-radius: em(3px);
    text-align: left;

    &.is-visible {
        display: block;
    }

    &:before {
        @include triangle($pointer-size, theme(border), down);
        content: " ";
        display: block;
        position: absolute;
        bottom: -($pointer-size/2);
        right: 2em;

        @include breakpoint($nav-label-break) {
            right: 50%;
            margin-right: -($pointer-size/2);
        }
    }

    &:after {
        @extend .nav-toc:before;
        border-top-color: theme(bg);
        bottom: -(($pointer-size/2) - 2);
    }

    // horizontal (persistent) state on large screens
    @include respond-to($nav-break) {
        display: block;
        position: relative;
        top: 0;
        margin: 0;
        background-color: transparent;
        border-radius: none;
        border: none;
        text-align: center;

        &:before, &:after { content: none; }

        li { display: inline-block; }
    }
}

.nav-logo {
    $h: 28px;

    @include rem(height, $h);
    @include rem(width, 70px);
    display: none;
    position: relative;
    padding: 0.7em 0;
    margin-right: 1em;
    float: left;
    max-width: auto;
    border-bottom: none;
    color: theme(text primary, reverse);
    background-color: transparent;

    @include respond-to('small') { display: inline-block; }

    @include respond-to($nav-break) { display: none; }
}

.nav-title {
    @extend .nav_link;
    display: none;
    float: left;
    padding: 1.5em 1em 0 0;
    text-overflow: ellipsis;
    color: theme(text primary, reverse);

    // override hover state of default nav link
    &:hover, &:active { color: theme(text primary, reverse); }

    @include respond-to('xsmall') { display: inline-block; }
    @include respond-to($nav-break) { display: none; }
}

.nav-item {
    @extend .nav_link;
    @include rem(margin, 0 fs(3));
    display: block;
    position: relative;
    padding: 1.5em 0;
    line-height: 1.2em; // to match the height of .nav-icon
    color: theme(text tertiary, reverse);

    &:hover, &:active {
        color: theme(text primary, reverse);
    }

    &.is-active {
        $border-w: 4px;

        @include respond-to($nav-break) {
            &:after {
                @include chapter_highlights(background-color);
                content: " ";
                display: block;
                position: absolute;
                top: -($border-w/2);
                left: 0;
                right: 0;
                height: $border-w;
                background-color: theme(highlight);

                .is-above & {
                    top: auto;
                    bottom: -($border-w/2);
                }
            }
        }
    }

    .nav-toc & {
        padding: 0.5em 0;

        &:hover, &:active { color: theme(text primary); }
        &:first-child { margin-top: 0.5em; }
        &:last-child { margin-bottom: 0.5em; }

        @include respond-to($nav-break) {
            padding: 1.5em 0;

            &:hover, &:active { color: theme(text primary, reverse); }
            &:first-child { margin-top: 0; }
            &:last-child { margin-bottom: 0; }
        }
    }

}

    .nav-flyout {
        @extend .nav-item;
        margin-right: 0;

        &.is-active {
            @include chapter_highlights;
            color: theme(highlight);
        }
    }

    .nav-icon {
        @extend .icon;
        margin: 0;
        height: 1.2em;
        width: 1.2em;
        fill: theme(text primary, reverse);

        // &:hover, &:active, .nav-item:hover &, .nav-item:active & {
        //     @include chapter_highlights(fill);
        //     fill: theme(highlight);
        // }

        &.left { margin-right: 0.3em; }
        &.right { margin-left: 0.3em; }
    }

    .nav-label {
        @extend .nav_link;
        display: none;

        &:hover, &:active {
            color: inherit;
        }

        @include breakpoint($nav-label-break) { display: inline-block; }
    }
